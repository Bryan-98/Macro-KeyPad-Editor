#include <SPI.h>
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>
#include "RTClib.h"

//Setting LCD
#define SCREEN_WIDTH 128  // OLED display width, in pixels
#define SCREEN_HEIGHT 32  // OLED display height, in pixels
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);

//Setting Animation
#define FRAME_DELAY (42)
#define FRAME_WIDTH (32)
#define FRAME_HEIGHT (32)
#define FRAME_COUNT (sizeof(frames) / sizeof(frames[0]))
uint8_t frame = 0;
const byte PROGMEM frames[][128] = {
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,8,136,17,16,8,152,25,16,8,152,25,16,8,152,25,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,8,152,25,16,8,152,25,16,8,152,25,16,8,136,17,16,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,16,8,152,1,16,8,152,25,16,8,152,25,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,8,152,25,16,8,152,25,16,8,152,1,16,0,128,1,16,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,0,128,1,0,0,128,1,16,0,152,1,16,0,152,1,16,8,152,17,16,8,152,25,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,8,152,25,17,8,152,17,16,0,152,1,16,0,152,1,16,0,128,1,16,0,128,1,0,0,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,128,1,16,0,152,1,16,0,152,1,16,0,152,1,16,8,152,1,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,152,25,17,8,152,1,16,0,152,1,16,0,152,1,16,0,152,1,16,0,128,1,16,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,152,0,16,0,152,1,16,0,152,1,16,0,152,1,16,0,152,1,17,136,153,145,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,145,17,0,152,1,17,0,152,1,16,0,152,1,16,0,152,1,16,0,152,0,16,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,24,0,16,0,24,0,16,0,152,0,16,0,152,1,16,0,152,1,16,128,152,1,17,136,153,129,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,129,17,128,152,1,17,0,152,1,16,0,152,1,16,0,152,0,16,0,24,0,16,0,24,0,16,0,0,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,152,1,16,0,152,1,17,128,153,129,17,128,153,129,17,136,153,145,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,145,17,128,153,129,17,128,153,129,17,0,152,1,17,0,152,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,128,152,1,17,128,153,129,17,128,153,129,17,136,153,129,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,129,17,128,153,129,17,128,153,129,17,128,152,1,17,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,8,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,128,24,0,17,128,153,128,17,128,153,129,17,128,153,129,17,136,153,145,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,145,17,128,153,129,17,128,153,129,17,128,153,128,17,128,24,0,17,0,24,0,16,0,24,0,16,0,24,0,16,0,24,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,16,0,24,0,16,0,24,0,17,128,25,128,17,128,25,128,17,128,153,129,17,128,153,129,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,128,153,129,17,128,153,129,17,128,25,128,17,128,25,128,17,0,24,0,17,0,24,0,16,0,24,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,24,0,17,128,25,128,17,128,25,128,17,128,25,128,17,128,153,128,17,136,153,145,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,145,17,128,153,128,17,128,25,128,17,128,25,128,17,128,25,128,17,0,24,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,9,128,17,128,25,128,17,128,25,128,17,128,25,128,17,128,25,128,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,128,25,128,17,128,25,128,17,128,25,128,17,128,25,128,17,128,9,128,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,128,1,128,1,128,9,128,17,128,25,128,17,128,25,128,17,136,25,144,17,136,25,152,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,25,152,17,136,25,144,17,128,25,128,17,128,25,128,17,128,9,128,17,128,1,128,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,25,128,17,128,25,128,17,136,25,152,17,136,25,152,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,25,152,17,136,25,152,17,128,25,128,17,128,9,128,17,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,136,25,144,17,136,25,152,17,136,25,152,17,136,25,152,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,25,152,17,136,25,152,17,136,25,152,17,136,25,144,17,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,136,1,128,1,136,9,152,1,136,25,152,17,136,25,152,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,25,152,17,136,25,152,17,136,9,152,1,136,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,128,1,128,1,128,1,128,1,136,1,152,1,136,1,152,1,136,25,152,17,136,25,152,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,25,152,17,136,25,152,17,136,1,152,1,136,1,152,1,136,1,128,1,128,1,128,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,128,1,136,1,152,1,136,1,152,1,136,1,152,1,136,9,152,1,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,9,152,1,136,1,152,1,136,1,152,1,136,1,152,1,128,1,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,24,0,136,1,152,1,136,1,152,1,136,1,152,1,136,1,152,1,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,137,153,17,136,1,152,1,136,1,152,1,136,1,152,1,136,1,152,1,8,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,24,0,8,0,24,0,8,0,24,0,136,1,152,1,136,1,152,1,136,129,153,1,136,129,153,1,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,129,153,1,136,129,153,1,136,1,152,1,136,1,152,1,8,0,24,0,8,0,24,0,8,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,136,0,24,1,136,1,152,1,136,129,153,1,136,129,153,1,136,137,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,137,153,17,136,129,153,1,136,129,153,1,136,1,152,1,8,0,24,1,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,16,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,136,128,25,1,136,129,153,1,136,129,153,1,136,129,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,129,153,17,136,129,153,1,136,129,153,1,136,128,25,1,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,128,25,0,136,129,153,1,136,129,153,1,136,137,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,137,153,17,136,129,153,1,136,129,153,1,8,128,25,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,24,0,8,0,24,0,8,0,24,0,8,128,25,0,8,128,25,0,136,128,25,1,136,129,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,129,153,17,136,128,25,1,8,128,25,0,8,128,25,0,8,0,24,0,8,0,24,0,8,0,24,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,8,0,24,0,8,128,25,0,8,128,25,0,8,128,25,0,8,128,25,0,136,137,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,137,153,17,8,128,25,0,8,128,25,0,8,128,25,0,8,128,25,0,8,0,24,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,128,1,0,8,128,25,0,8,128,25,0,8,128,25,0,8,128,25,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,152,25,17,8,128,25,16,8,128,25,0,8,128,25,0,8,128,25,0,8,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,0,128,1,0,8,128,1,0,8,128,25,0,8,128,25,0,8,136,25,16,8,152,25,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,8,152,25,16,8,136,25,16,8,128,25,0,8,128,25,0,8,128,1,0,0,128,1,0,0,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,8,128,1,0,8,128,25,16,8,152,25,16,8,152,25,16,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,136,153,153,17,8,152,25,16,8,152,25,16,8,128,25,16,8,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,128,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}};

//Setting RTC
RTC_DS3231 rtc;
String hour;
String min;
String sec;

void setup() {
  //initializing RTC
  if (! rtc.begin()) {
    Serial.println("Couldn't find RTC");
    Serial.flush();
    while (1) delay(10);
  }
  //rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));
  hour.reserve(3);
  min.reserve(3);
  sec.reserve(3);

  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  display.clearDisplay();
  delay(2000);

}

void loop() {
  DateTime now = rtc.now();
  hour = "";
  min = "";
  sec = "";
  if(now.twelveHour() < 10) {
    hour += "0"; 
    hour += now.twelveHour();
  }else{
    hour += now.twelveHour();
  }
  if(now.minute() < 10) {
    min += "0";
    min += now.minute();
  }else{
    min += now.minute();
  }
  if(now.second() < 10) {
    sec += "0";
    sec += now.second();
  }else{
    sec += now.second();
  }
  
  display.clearDisplay();
  display.setRotation(3);
  display.setTextSize(2);
  // Top Icon
  display.drawBitmap(0, 0, frames[frame], FRAME_WIDTH, FRAME_HEIGHT, 1);
  // Hour text
  display.setCursor(4, 40);
  display.setTextColor(SSD1306_WHITE);
  display.println(hour);
  // Coloen text
  display.setCursor(10, 55);
  display.println(":");
  // Minute Text
  display.setCursor(4, 70);
  display.println(min);
  // Colon text
  display.setCursor(10, 85);
  display.println(":");
  // Seconds text
  display.setCursor(4, 100);
  display.println(sec);

  display.display();
  frame = (frame + 1) % FRAME_COUNT;
  delay(FRAME_DELAY);

}
